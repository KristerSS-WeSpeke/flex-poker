<template id="fp-chat">
    <style>
        textarea {
            height: 100px;
            width: 100%;
            background-color: white;
        }

        input[type=text] {
            width: 100%;
        }
    </style>

    <div>
        <textarea id="chat-text" disabled="disabled"></textarea>
        <form id="chat-form">
            <div>
                <label>Message:</label>
                <input id="chat-message" type="text" />
                <input type="submit" value="Send" />
            </div>
        </form>
    </div>
</template>


<script>
"use strict";

(function(){
    let localDocument = (document._currentScript || document.currentScript).ownerDocument;
    let element = Object.create(HTMLElement.prototype);
    element.displayChat = function(message) {
        let chatTextArea = this.shadowRoot.querySelector('#chat-text');
        let scrollHeight = chatTextArea['scrollHeight'];
        chatTextArea['scrollTop'] = scrollHeight;
        chatTextArea.value += message + '\n';
    };

    element.createdCallback = function() {
        let template = localDocument.querySelector('#fp-chat').content;
        let templateNode = document.importNode(template, true);

        let chatForm = templateNode.querySelector('#chat-form');

        chatForm.addEventListener('submit', function(evt) {
            evt.preventDefault();
            let messageTxtBox = this[0];
            if (messageTxtBox.value) {
                let chatMsgEnteredEvt = new CustomEvent('chat-msg-entered', {
                    detail: messageTxtBox.value,
                    bubbles: true
                });
                messageTxtBox.value = '';
                chatForm.dispatchEvent(chatMsgEnteredEvt);
            }
        });

        this.createShadowRoot().appendChild(templateNode);
    };

    document.registerElement('fp-chat', {
        prototype: element
    });
})();
</script>
