<template id="fp-gamelist">
    <style>
        table {
            width: 100%;
        }

        thead {
            background-color: #eaeaea;
        }

        td {
            border-bottom: 1px solid #d4d4d4;
        }

        tr.odd td {
            background-color: #fdfdfd;
        }

        tr.even td {
            background-color: #f3f3f3;
        }

        tr.even.selected td, table tr.odd.selected td {
            background-color: #c9dde1;
        }
    </style>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Stage</th>
                <th>Registered Players</th>
                <th>Total Players</th>
                <th>Players Per Table</th>
                <th>Creator</th>
                <th>Created</th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</template>

<script>
"use strict";

(function(){
    let localDocument = (document._currentScript || document.currentScript).ownerDocument;
    let element = Object.create(HTMLElement.prototype);

    element.createdCallback = function() {
        let template = localDocument.querySelector('#fp-gamelist').content;
        let templateNode = document.importNode(template, true);
        this.createShadowRoot().appendChild(templateNode);

        let table = this.shadowRoot.querySelector('table');

        table.addEventListener('click', function(evt) {
            if(evt.target && evt.target.nodeName === "TD") {
                let row = evt.target.parentNode;
                if (row.className.includes('selected')) {
                    row.className = row.className.replace('selected', '').trim();
                } else {
                    row.className += ' selected';
                }
            } else if (evt.target && evt.target.nodeName === "BUTTON") {
                let gameId = evt.target.dataset.gameId;

                let chatMsgEnteredEvt = new CustomEvent('game-open-selected', {
                    detail: gameId,
                    bubbles: true
                });
                evt.target.dispatchEvent(chatMsgEnteredEvt);
            }
        });
    };

    element.displayGames = function(gameList) {
        let table = this.shadowRoot.querySelector('table');
        let oldBody = table.querySelector('tbody');
        let newBody = document.createElement('tbody');

        gameList.forEach(function(game, index, gameList) {
            let row = newBody.insertRow(newBody.rows.length);
            row.className = index % 2 === 0 ? 'even' : 'odd';

            let openGameButton = document.createElement('button');
            openGameButton.innerHTML = 'Open Game';
            openGameButton.dataset.gameId = game['id'];

            row.insertCell(0).appendChild(document.createTextNode(game['name']));
            row.insertCell(1).appendChild(document.createTextNode(game['stage']));
            row.insertCell(2).appendChild(document.createTextNode(game['numberOfRegisteredPlayers']));
            row.insertCell(3).appendChild(document.createTextNode(game['maxNumberOfPlayers']));
            row.insertCell(4).appendChild(document.createTextNode(game['maxPlayersPerTable']));
            row.insertCell(5).appendChild(document.createTextNode(game['createdBy']));
            row.insertCell(6).appendChild(document.createTextNode(game['createdOn']));
            row.insertCell(7).appendChild(openGameButton);
        });

        table.replaceChild(newBody, oldBody);
    };

    document.registerElement('fp-gamelist', {
        prototype: element
    });
})();
</script>
